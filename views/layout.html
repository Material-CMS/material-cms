{# Automatically extends the right outer layout and also handles AJAX siutations #}
{% extends data.outerLayout %}

{# Imports #}
{% import 'apostrophe-favicons:faviconMacros.html' as favicons %}
{% import 'apostrophe-palette-widgets:macros.html' as palette %}

{# Page Title depends on variables above #}
{% if data.piece %}
  {% if data.piece.seoTitle %}
    {% set title = data.piece.seoTitle %}
  {% else %}
    {% set title = data.piece.title %}
  {% endif %}
{% else %}
  {% if data.page.seoTitle %}
    {% set title = data.page.seoTitle %}
  {% else %}
    {% set title = data.page.title %}
  {% endif %}
{% endif %}

{# Actual Title #}
{% block title %}{{ title }}{% endblock %}

{% block extraHead %}

  {# Palette #}
  {{ palette.stylesheetLink(data.global) }}
  {{ palette.stylesheetTag() }}

  {# Includes #}
  {% include "apostrophe-assets:styles.html" %}
  {% include "apostrophe-seo:view.html" %}
  {% include "apostrophe-open-graph:view.html" %}

  {# Favicons #}
  {{ favicons.renderLinks(apos, data.global) }}

{% endblock %}

{% block beforeMain %}

  {# Inject Apostrophe Palette #}
  {% if data.user %}
    {{ palette.palette(data.global, 'palette') }}
  {% endif %}

  {# Navigation #}
  <div class="nav-content">
    {{ apos.area(data.page, 'navigationArea', {
      limit: 1,
      widgets: {
        'navigations': {
          addLabel: 'Add Navigation',
          editLabel: 'Change Navigation',
          controls: {
            movable: false,
            cloneable: false,
            removable: true,
            position: 'top-left'
          }
        }
      }
    }) }}
  </div>
{% endblock %}

{% block main %}
  {#
    Usually, your page templates in the apostrophe-pages module will override
    this block. It is safe to assume this is where your page-specific content
    should go.
  #}
{% endblock %}

{% block afterMain %}

  {# Footer #}
  <div class="footer-content">
    {% if not data.page.hideFooter %}
      {{ apos.area(data.page, 'footerArea', {
        limit: 1,
        widgets: {
          'footer': {
            addLabel: 'Add Footer',
            editLabel: 'Change Footer',
            controls: {
              movable: false,
              removable: true,
              position: 'top-left'
            }
          }
        }
      }) }}
    {% endif %}
  </div>

  {# Contact Button #}
  {% if data.global.showContactButton and not data.page.hideContactButton %}
    {% include "btn-widgets:widget.html" %}
  {% endif %}

{% endblock %}
