{# Build the style strings #}
{% set overlayColor = "background-color: " + (data.widget.overlayColor) %}

{% for _image in piece._images %}

  <div class="images-container{% if piece.forceAspectRatio %} ratio-1-1{% endif %}">
    <div class="image-radius{% if piece.imagesShadow %} z-depth-1{% endif %}">

      <div class="card">

        <div class="height-100 {% if piece.lightboxOn %} lightbox{% endif %}">

          <div class="card-image">
            <img src="{{ apos.attachments.url(_image.attachment, { size: 'one-third', crop: relationship }) }}"
              srcset="{{ apos.images.srcset(_image.attachment) }}"
              sizes="(min-width:1200px)20vw, 30vw"
              alt="{{ _image.title }}"
              width="100%"
            >
          </div>

          {% if piece.lightboxOn %}

            {# Lightbox overlay #}
            <div class="lightbox-overlay" style="{{ overlayColor }}"></div>

            {# Lightbox image #}
            <div class="lightbox-image image-radius">
              {% if data.widget.lightboxNoCrop %}
                <img
                  data-src="{{ apos.attachments.url(_image.attachment, { size: 'full' }) }}"
                  srcset="{{ apos.images.srcset(_image.attachment) }}"
                  sizes="{{ data.options.sizesAttr or '100vw' }}"
                  alt="{{ image.title }}"
                >
              {% else %}
                <img
                  data-src="{{ apos.attachments.url(_image.attachment, { size: 'full', crop: relationship }) }}"
                  srcset="{{ apos.images.srcset(_image.attachment, relationship ) }}"
                  sizes="{{ data.options.sizesAttr or '100vw' }}"
                  alt="{{ image.title }}"
                >
              {% endif %}
            </div>

          {% endif %}

        </div>

      </div>
    </div>

  </div>

{% endfor %}
