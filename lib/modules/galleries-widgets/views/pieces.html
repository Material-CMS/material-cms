{# Cache pieces #}
{% set pieces = data.widget._pieces or data.pieces %}

{# Build the style strings #}
{% set color = "color: " + (piece.titleColor or data.widget.galleriesTitlesColor) %}
{% set backgroundColor = "background-color: " + (data.widget.backColor or piece.backColor) %}

{% for piece in pieces %}
  <div class="card z-depth-0" style="{{ backgroundColor }}"
  >
    <div class="card-content" style="{{ backgroundColor }}"
    >

    <div class="row">
      <div class="col s12 m12">

        {% if piece.titleDisplay or data.widget.galleriesTitlesDisplay %}
            {% if piece._url %}
              <a class="piece-url" href="{{ piece._url }}">
            {% endif %}
                <h3 class="accent-color card-title {{ data.widget.galleriesTitlesAlign }}" 
                  style="{{ color }}">
                  {{ piece.title }}
                </h3>
            {% if piece._url %}
              </a>
            {% endif %}
        {% endif %}

          <div class="gallery">

            <div class="images column-count-{{ piece.columnCount }}">

              {# Includes #}
              {% include "images.html" %}

            </div>

          </div>

        </div>
      </div>

    </div>
  </div>
{% endfor %}
