<div data-apos-ajax-append>

  {% for piece in data.pieces %}
    <div class="gallery">
      <div class="row margin">

        <div class="header">
          <a href="{{ piece._url }}">
            <h3 class="accent-color" style="
              {%- if piece.headerColor -%}
                color:{{ piece.headerColor }}
              {% endif %}
            ">
              {{ piece.title }}
            </h3>
          </a>
        </div>

        {% for _image in piece._images %}
          <div class="col s6 m3">
            <div class="card">
              <div class="card-image">
                <img class="materialboxed responsive-img" src="{{ apos.attachments.url(_image.attachment, { size: data.options.size or 'one-third' }) }}"
                  alt="{{ _image.description or _image.title }}" width="100%">
              </div>
            </div>
          </div>
        {% endfor %}

      </div>
    </div>
  {% endfor %}

</div>

{% if data.currentPage < data.totalPages %}
  <a data-apos-ajax-infinite-scroll href="{{ data.url | build({ page: data.currentPage + 1, append: 1 }) }}">Load More...</a>
{% endif %}

{% block afterMain %}
  {# Temporaly workaround because materialized components won't get injected the normal way in data-apos-ajax-append #}
  <script>
    // Material Box
    var materialboxes = document.querySelectorAll('.materialboxed');
    for (var i = 0; i < materialboxes.length; i++) {
      M.Materialbox.init(materialboxes[i], {
        // example-option: true
      });
    }
  </script>
{% endblock %}
