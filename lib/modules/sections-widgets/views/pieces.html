{% set pieces = data.widget._pieces or data.pieces %}


{% for piece in pieces %}

  {# Parallax Container #}
  {% if piece.sectionStyle == 'default' and (piece._backgroundImage and piece.backgroundImageParallax) %}
    <div class="parallax-container">

      {# Parallax Image #}
      <div class="parallax">
        <img
          src="{{ apos.attachments.url(piece._backgroundImage.attachment, { size: data.options.size or 'one-third' }) }}"
          srcset="{{ apos.images.srcset(piece._backgroundImage.attachment) }}"
          sizes="(max-width:600px) 50vw, 60vw"
          alt="{{ piece._backgroundImage.description or piece._backgroundImage.title }}"
        >
      </div>

      {# Top Shape Divider #}
      {% if piece.shapeDividerTop %}
        <div class="shape-divider-top"
          {% if piece.backgroundColor or data.global.backgroundColor %}
            style="fill: {{ piece.backgroundColor or data.global.backgroundColor }}"
          {% endif %}
        >
          {{ apos.area(piece, 'shapeDividerTop', {
            widgets: {
              'shape-divider-path': {
                addLabel: 'Add Shape Divider',
                editLabel: 'Change Shape Divider',
                controls: {
                  cloneable: false,
                  removable: true,
                  movable: false,
                  position: 'top-left'
                }
              }
            }
          }) }}
        </div>
      {% endif %}

    </div>
  {% endif %}

  {# Section #}
  <div id="{{ piece.slug }}" class="section"
    {% if piece.backgroundColor %}
      style="background-color:{{ piece.backgroundColor }};"
    {% endif %}
  >

    {# Background Image #}
    {% if piece._backgroundImage and not piece.backgroundImageParallax %}
      <div class="background-image">
        <img
          src="{{ apos.attachments.url(piece._backgroundImage.attachment, { size: data.options.size or 'one-third' }) }}"
          srcset="{{ apos.images.srcset(piece._backgroundImage.attachment) }}"
          sizes="(max-width:600px) 50vw, 60vw"
          alt="{{ piece._backgroundImage.description or piece._backgroundImage.title }}"
        >
      </div>
    {% endif %}

    {# Small Side Image #}
    {% if piece._sideImage %}
      <div class="side-image"
        {% if piece.sideImageRight %}
          style="right:0;"
        {% endif %}
      >
        <img
          src="{{ apos.attachments.url(piece._sideImage.attachment, { size: data.options.size or 'one-third' }) }}"
          srcset="{{ apos.images.srcset(piece._sideImage.attachment) }}"
          sizes="(max-width:600px) 50vw, 40vw"
          alt="{{ piece._sideImage.description or piece._sideImage.title }}"
        >
      </div>
    {% endif %}

    {# Slide #}
    {% if piece.sectionStyle == 'slide' %}
      <div class="slide-content">

        {{ apos.singleton(piece, 'sliderContent', 'slider', {
          size: 'full',
          sizesAttr: '(max-width:600px) 120vw, 58vw',
          noHeight: true,
          focalPoint: true,
          controls: {
            movable: false,
            cloneable: false,
            removable: true,
            position: 'top-right'
          }
        }) }}

      </div>
    {% endif %}

    {# Main Content#}
    <div class="main-content{% if piece.sectionStyle == 'slide' %} half{% endif %}"
      {% if data.widget.sectionMinHeight and piece.sectionStyle == 'default' %}
        style="min-height: 100vh;"
      {% endif %}
    >

    {% if piece.container %}
      <div class="container">
    {% endif %}

        <div class="widgets-container">

          {# Header #}
          {% if piece.header %}
            <h2 class="section-header accent-color
              {% if piece.headerAlign == 'left' %}
                left-align
              {% elif piece.headerAlign == 'center' %}
                center-align
              {% elif piece.headerAlign == 'right' %}
                right-align
              {% endif %}"
              {% if piece.headerColor %}
                style="color: {{ piece.headerColor }}"
              {% endif %}
            >
              {{ piece.header }}
            </h2>
          {% endif %}

          {% if piece.glueWidgets == true %}
            <div class="glue-container">
          {% endif %}

              {{ apos.area(piece, 'content', {
                widgets: {
                  'card': {
                    size: 'one-half',
                    limit: 1,
                    noHeight: true,
                    sizesAttr: '(max-width:600px) 50vw, 40vw',
                    controls: {
                      cloneable: false,
                      removable: true,
                      position: 'top-right'
                    }
                  },
                  'double': {
                    controls: {
                      cloneable: false,
                      removable: true,
                      position: 'top-right'
                    }
                  },
                  'events': {
                    controls: {
                      cloneable: false,
                      removable: true,
                      position: 'top-right'
                    }
                  },
                  'texts': {
                    controls: {
                      cloneable: false,
                      removable: true,
                      position: 'top-right'
                    }
                  },
                  'texts-carousels': {
                    controls: {
                      cloneable: false,
                      removable: true,
                      position: 'top-right'
                    }
                  },
                  'video': {
                    controls: {
                      cloneable: false,
                      removable: true,
                      position: 'top-right'
                    }
                  },
                  'galleries': {
                    controls: {
                      cloneable: false,
                      removable: true,
                      position: 'top-right'
                    }
                  },
                  'people': {
                    controls: {
                      cloneable: false,
                      removable: true,
                      position: 'top-right'
                    }
                  },
                  'tables': {
                    controls: {
                      cloneable: false,
                      removable: true,
                      position: 'top-right'
                    }
                  },
                  'swiper': {
                    controls: {
                      cloneable: false,
                      removable: true,
                      position: 'top-right'
                    }
                  },
                  'apostrophe-forms': {
                    controls: {
                      movable: false,
                      cloneable: false,
                      removable: true,
                      position: 'top-right'
                    }
                  }
                }
              }) }}

          {% if piece.glueWidgets == true %}
            </div>
          {% endif %}

        </div>

    {% if piece.container %}
      </div>
    {% endif %}

    </div>
  </div>


  {# Bottom Shape Divider #}
  {% if piece.shapeDividerBottom %}
    <div class="shape-divider-bottom"
      {% if piece.backgroundColor or data.global.backgroundColor %}
        style="fill: {{ piece.backgroundColor or data.global.backgroundColor }}"
      {% endif %}
    >
      {{ apos.area(piece, 'shapeDividerBottom', {
        limit: 1,
        widgets: {
          'shape-divider-path': {
            addLabel: 'Add Shape Divider',
            editLabel: 'Change Shape Divider',
            controls: {
              cloneable: false,
              removable: true,
              movable: false,
              position: 'top-left'
            }
          }
        }
      }) }}
    </div>
  {% endif %}

{% endfor %}
