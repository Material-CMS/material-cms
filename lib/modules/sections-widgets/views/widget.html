<div class="nav">

  {# Main Nav #}
  <nav>
    <div class="nav-wrapper z-depth-2">
      <a class="brand-logo" href="#">
        <h1 class="accent-color">
          {% if data.page.seoTitle %}
            {% set title = data.home.seoTitle %}
          {% else %}
            {% set title = data.home.title %}
          {% endif %}
          {# Page Title depends on variables above #}
          {% block title %}{{ title }}{% endblock %}
        </h1>
      </a>
      <a class="accent-color sidenav-trigger" href="#" data-target="mobile"><i class="material-icons">menu</i></a>
      <ul class="nav-activator right hide-on-med-and-down
        {% if data.widget.i18nNav == true %}
          i18n
        {% endif %}
      ">
        {# Language Switch #}
        {% if data.widget.i18nNav == true %}
          <i class="accent-color material-icons left">language</i>
        {% endif %}

        {# Home Active #}
        <li
          {% if data.page._children[0] %}
            class="active"
          {% endif %}
        >
          <a href="{{ data.home._url }}" data-target="desktop-dropdown" class="accent-color flow-text
            {% if data.page._children[0] %}
              dropdown-trigger
            {% endif %}
          ">
            {{ data.home.title }}
            {% if data.page._children[0] %}
              <i class="material-icons left">arrow_drop_down</i>
            {% endif %}
          </a>
        </li>

        {# Home Cildren Active #}
        {% for tab in data.home._children %}
          <li
            {% if data.page and (apos.pages.isAncestorOf(tab, data.page) or tab._id == data.page._id) %}
              class="active"
            {% endif %}
          >
            <a href="{{ tab._url }}" data-target="desktop-dropdown" class="accent-color flow-text
              {% if data.page and (apos.pages.isAncestorOf(tab, data.page) or tab._id == data.page._id) %}
                dropdown-trigger
              {% endif %}
            ">
              {{ tab.title }}
              {% if data.page and (apos.pages.isAncestorOf(tab, data.page) or tab._id == data.page._id) %}
                <i class="material-icons left">arrow_drop_down</i>
              {% endif %}
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>
  </nav>

  {# Dropdown Desktop #}
  <ul class="dropdown-content" id="desktop-dropdown">
    {% for piece in data.widget._pieces %}
      <li><a class="accent-color flow-text anchor" href="#{{ piece.slug }}">{{ piece.title }}</a></li>
    {% endfor %}
  </ul>

  {# Sidenav #}
  <ul class="sidenav" id="mobile">

    {# Home Active #}
    <li
      {% if data.page._children[0] %}
        class="active"
      {% endif %}
    >
      <a href="{{ data.home._url }}" data-target="mobile-dropdown" class="accent-color flow-text waves-effect waves-light
        {% if data.page._children[0] %}
          dropdown-trigger
        {% endif %}
      ">
        {{ data.home.title }}
        {% if data.page._children[0] %}
          <i class="material-icons right">arrow_drop_down</i>
        {% endif %}
      </a>
    </li>

    {# Home Cildren Active #}
    {% for tab in data.home._children %}
      <li
        {% if data.page and (apos.pages.isAncestorOf(tab, data.page) or tab._id == data.page._id) %}
          class="active"
        {% endif %}
      >
        <a href="{{ tab._url }}" data-target="mobile-dropdown" class="accent-color flow-text waves-effect waves-light
          {% if data.page and (apos.pages.isAncestorOf(tab, data.page) or tab._id == data.page._id) %}
            dropdown-trigger
          {% endif %}
        ">
          {{ tab.title }}
          {% if data.page and (apos.pages.isAncestorOf(tab, data.page) or tab._id == data.page._id) %}
            <i class="material-icons right">arrow_drop_down</i>
          {% endif %}
        </a>
      </li>
    {% endfor %}

    {# Dropdown Mobile #}
    <ul class="dropdown-content" id="mobile-dropdown">
      {% for piece in data.widget._pieces %}
        <li><a class="accent-color flow-text anchor" href="#{{ piece.slug }}">{{ piece.title }}</a></li>
      {% endfor %}
    </ul>

  </ul>

</div>

{# Sections #}
<div class="section-wrapper">

  {% for piece in data.widget._pieces %}
      {# Background settings #}
    <div id="{{ piece.slug }}" class="section page" style="
      {%- if piece._image.attachment  -%}
        background-image: url({{ apos.attachments.url(piece._image.attachment, { size: data.options.size or 'full' }) }})
      {%- elif piece.color -%}
        background-color:{{ piece.color }}
      {% endif %}
    ">
      {# Slide #}
      {%- if piece.preferences == 'slideOn' -%}
        <div class="slide-content">
          {{ apos.singleton(piece, 'content', 'slides', {
            limit: 1,
            controls: {
              movable: false,
              cloneable: false,
              removable: true,
              position: 'top-right'
            }
          }) }}
        </div>

      {# Footer #}
      {%- elif piece.preferences == 'footerOn' -%}
        <div class="main-content">

        {%- if piece.headerOn == true and piece.cardOn == false -%}
          <div class="header">
            <h3 class="accent-color" style="
              {%- if piece.headerColor -%}
                color:{{ piece.headerColor }}
              {% endif %}
            ">
              {{ piece.title }}
            </h3>
          </div>
        {%- endif -%}

        {%- if piece.containerOn == true -%}
          <div class="container">
        {%- endif -%}

            <div class="widgets-container">

            {%- if piece.cardOn == true -%}
              <div class="card">
                <div class="card-content">
            {% endif %}

              {%- if piece.cardOn and piece.headerOn == true -%}
                <div class="card-title">
                  <h3 class="accent-color" style="
                    {%- if piece.headerColor -%}
                      color:{{ piece.headerColor }}
                    {% endif %}
                  ">
                    {{ piece.title }}
                  </h3>
                </div>
              {%- endif -%}

                {{ apos.area(piece, 'content', {
                  limit: 1,
                  widgets: {
                    'contact-form': {
                      controls: {
                        movable: false,
                        cloneable: false,
                        removable: true,
                        position: 'top-right'
                      }
                    }
                  }
                }) }}

            {%- if piece.cardOn == true -%}
                </div>
              </div>
            {% endif %}

            </div>
        {%- if piece.containerOn == true -%}
          </div>
        {%- endif -%}

        </div>

        <div class="bottom-content">
          {% include "footer-widgets:widget.html" %}
        </div>

      {# Main Widgets #}
      {%- else -%}
        <div class="main-content">

          {%- if piece.headerOn == true and piece.cardOn == false -%}
            <div class="header">
              <h3 class="accent-color" style="
                {%- if piece.headerColor -%}
                  color:{{ piece.headerColor }}
                {% endif %}
              ">
                {{ piece.title }}
              </h3>
            </div>
          {%- endif -%}

        {%- if piece.containerOn == true -%}
          <div class="container">
        {%- endif -%}

            <div class="widgets-container">

              {%- if piece.cardOn == true -%}
                <div class="card">
                  <div class="card-content">
              {% endif %}

                {%- if piece.cardOn and piece.headerOn == true -%}
                  <div class="card-title">
                    <h3 class="accent-color" style="
                      {%- if piece.headerColor -%}
                        color:{{ piece.headerColor }}
                      {% endif %}
                    ">
                      {{ piece.title }}
                    </h3>
                  </div>
                {%- endif -%}

                  {{ apos.area(piece, 'content', {
                    limit: 2,
                    widgets: {
                      'card': {
                       minSize: [ 700, 350 ],
                       aspectRatio: [ 2, 1 ],
                       size: 'full',
                        controls: {
                          cloneable: false,
                          removable: true,
                          position: 'top-right'
                        }
                      },
                      'double': {
                        controls: {
                          cloneable: false,
                          removable: true,
                          position: 'top-right'
                        }
                      },
                      'events': {
                        controls: {
                          cloneable: false,
                          removable: true,
                          position: 'top-right'
                        }
                      },
                      'texts': {
                        controls: {
                          cloneable: false,
                          removable: true,
                          position: 'top-right'
                        }
                      },
                      'video': {
                        controls: {
                          cloneable: false,
                          removable: true,
                          position: 'top-right'
                        }
                      },
                      'contact-form': {
                        controls: {
                          cloneable: false,
                          removable: true,
                          position: 'top-right'
                        }
                      }
                    }
                  }) }}
              {%- if piece.cardOn == true -%}
                  </div>
                </div>
              {% endif %}

            </div>

        {%- if piece.containerOn == true -%}
          </div>
        {%- endif -%}

        {%- if data.widget.buttonOn == true -%}
          <div class="fixed-action-btn">
            <a class="btn-floating btn-large red">
              <i class="large material-icons">mode_edit</i>
            </a>
            <ul>
              <li>
                <a class="btn-floating tip" href="tel:{{ data.global.phone }}"><i class="material-icons">local_phone</i></a>
                <a class="btn-floating fab-tip">{{ data.global.phone }}</a>
              </li>
              <li>
                <a class="btn-floating tip" href="mailto:{{ data.global.email }}"><i class="material-icons">email</i></a>
                <a class="btn-floating fab-tip">{{ data.global.email }}</a>
              </li>
            </ul>
          </div>
        {%- endif -%}

        </div>
      {% endif %}

    </div>
  {% endfor %}
</div>
